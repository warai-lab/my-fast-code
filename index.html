<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>warai-lab / my-fast-code 掲示板ログ</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f5f5f5;
      --card-bg: #ffffff;
      --text: #222222;
      --muted: #666666;
      --accent: #0366d6;
      --border: #e0e0e0;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0f1115;
        --card-bg: #16191f;
        --text: #f0f3f9;
        --muted: #9aa0ae;
        --accent: #4ea1ff;
        --border: #30343c;
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    header {
      padding: clamp(16px, 4vw, 32px);
      text-align: center;
    }

    header h1 {
      margin: 0 0 0.5rem;
      font-size: clamp(1.5rem, 6vw, 2.2rem);
    }

    header p {
      margin: 0.25rem 0;
      color: var(--muted);
      font-size: clamp(0.95rem, 4vw, 1.05rem);
    }

    .cta {
      display: inline-flex;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .cta a {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.65rem 1.2rem;
      border-radius: 999px;
      text-decoration: none;
      font-weight: 600;
      color: var(--accent);
      border: 1px solid var(--accent);
      transition: all 0.2s ease;
      background: transparent;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
    }

    .cta a:hover,
    .cta a:focus-visible {
      background: var(--accent);
      color: #fff;
      outline: none;
    }

    main {
      width: min(960px, 92vw);
      margin: 0 auto 48px;
    }

    #issues {
      display: grid;
      gap: clamp(12px, 3vw, 20px);
      padding-bottom: 24px;
    }

    .issue-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: clamp(16px, 3vw, 24px);
      border: 1px solid var(--border);
      box-shadow: 0 16px 32px rgba(15, 17, 21, 0.06);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .issue-card:hover,
    .issue-card:focus-within {
      transform: translateY(-2px);
      box-shadow: 0 18px 36px rgba(15, 17, 21, 0.12);
    }

    .issue-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 12px;
    }

    .issue-title {
      font-size: clamp(1.05rem, 4vw, 1.2rem);
      font-weight: 600;
      margin: 0;
    }

    .issue-title a {
      color: inherit;
      text-decoration: none;
    }

    .issue-title a:hover,
    .issue-title a:focus-visible {
      text-decoration: underline;
    }

    .issue-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .issue-body {
      white-space: pre-wrap;
      margin-top: 12px;
      font-size: 0.95rem;
    }

    .labels {
      display: inline-flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .label {
      border-radius: 999px;
      padding: 0.25rem 0.6rem;
      font-size: 0.75rem;
      font-weight: 600;
      background: rgba(3, 102, 214, 0.12);
      color: var(--accent);
    }

    #status {
      text-align: center;
      color: var(--muted);
      margin: 24px 0;
      font-size: 0.95rem;
    }

    .footer-note {
      text-align: center;
      padding: 24px clamp(16px, 5vw, 32px);
      font-size: 0.85rem;
      color: var(--muted);
    }

    @media (max-width: 600px) {
      .issue-card {
        border-radius: 12px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>warai-lab / my-fast-code 掲示板ログ</h1>
    <p>GitHub Issues を掲示板のように活用しています。最新の投稿は以下をご覧ください。</p>
    <div class="cta">
      <a href="https://github.com/warai-lab/my-fast-code/issues/new" target="_blank" rel="noopener">
        💬 投稿する（GitHub Issues）
      </a>
      <a href="https://github.com/warai-lab/my-fast-code/issues" target="_blank" rel="noopener">
        📚 Issues 一覧を開く
      </a>
    </div>
  </header>

  <main>
    <div id="status">読み込み中...</div>
    <div id="issues" aria-live="polite"></div>
  </main>

  <footer class="footer-note">
    GitHub API から最新 50 件の Issue を取得しています。閲覧に GitHub アカウントは不要です。投稿時は Issue 画面でログインしてください。
  </footer>

  <script>
    const repoOwner = "warai-lab";
    const repoName = "my-fast-code";
    const issuesContainer = document.getElementById("issues");
    const statusEl = document.getElementById("status");

    const fetchIssues = async () => {
      const endpoint = `https://api.github.com/repos/${repoOwner}/${repoName}/issues?state=all&per_page=50`;
      try {
        const response = await fetch(endpoint, {
          headers: { "Accept": "application/vnd.github+json" },
          cache: "no-store"
        });

        if (!response.ok) {
          throw new Error(`GitHub API error: ${response.status}`);
        }

        const issues = await response.json();
        renderIssues(issues.filter(issue => !issue.pull_request));
      } catch (err) {
        console.error(err);
        if (err?.message?.includes("404")) {
          statusEl.textContent = "リポジトリが見つかりませんでした。URL を再確認してください。";
        } else {
          statusEl.textContent = "読み込みに失敗しました。少し時間を置いて再度お試しください。";
        }
      }
    };

    const formatRelativeTime = (dateString) => {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffSeconds = Math.floor(diffMs / 1000);

      if (diffSeconds < 60) return `${diffSeconds} 秒前`;
      const diffMinutes = Math.floor(diffSeconds / 60);
      if (diffMinutes < 60) return `${diffMinutes} 分前`;
      const diffHours = Math.floor(diffMinutes / 60);
      if (diffHours < 24) return `${diffHours} 時間前`;
      const diffDays = Math.floor(diffHours / 24);
      if (diffDays < 7) return `${diffDays} 日前`;
      const diffWeeks = Math.floor(diffDays / 7);
      if (diffWeeks < 5) return `${diffWeeks} 週間前`;
      const diffMonths = Math.floor(diffDays / 30);
      if (diffMonths < 12) return `${diffMonths} か月前`;
      const diffYears = Math.floor(diffDays / 365);
      return `${diffYears} 年前`;
    };

    const renderIssues = (issues) => {
      if (!issues.length) {
        statusEl.textContent = "まだ投稿がありません。最初の投稿をしてみましょう！";
        return;
      }

      statusEl.textContent = "";

      const fragment = document.createDocumentFragment();

      issues.forEach((issue) => {
        const card = document.createElement("article");
        card.className = "issue-card";

        const header = document.createElement("div");
        header.className = "issue-header";

        const title = document.createElement("h2");
        title.className = "issue-title";
        const link = document.createElement("a");
        link.href = issue.html_url;
        link.target = "_blank";
        link.rel = "noopener";
        link.textContent = issue.title || "(無題)";
        title.appendChild(link);

        const meta = document.createElement("div");
        meta.className = "issue-meta";
        const author = issue.user?.login ?? "unknown";
        const stateLabel = issue.state === "open" ? "公開中" : "クローズ";
        meta.innerHTML = `
          <span>投稿者: @${author}</span>
          <span>状態: ${stateLabel}</span>
          <span>更新: ${formatRelativeTime(issue.updated_at)}</span>
          <span>コメント: ${issue.comments}</span>
        `;

        header.appendChild(title);
        header.appendChild(meta);

        const body = document.createElement("div");
        body.className = "issue-body";
        body.textContent = issue.body ? issue.body.trim() : "(本文なし)";

        const labelsWrapper = document.createElement("div");
        labelsWrapper.className = "labels";
        issue.labels?.forEach((label) => {
          const badge = document.createElement("span");
          badge.className = "label";
          badge.style.backgroundColor = `#${label.color}20`;
          badge.style.color = `#${label.color}`;
          badge.textContent = label.name;
          labelsWrapper.appendChild(badge);
        });

        card.appendChild(header);
        card.appendChild(body);
        if (labelsWrapper.children.length) {
          card.appendChild(labelsWrapper);
        }

        fragment.appendChild(card);
      });

      issuesContainer.innerHTML = "";
      issuesContainer.appendChild(fragment);
    };

    document.addEventListener("DOMContentLoaded", fetchIssues);
  </script>
</body>
</html>
